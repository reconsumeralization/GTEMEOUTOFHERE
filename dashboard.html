<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>COSURVIVAL | Connected Intelligence Network</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Cosmic Dark Theme */
            --bg-primary: #0a0a0f;
            --bg-secondary: #12121a;
            --bg-tertiary: #1a1a26;
            --bg-card: rgba(26, 26, 38, 0.8);
            
            /* Accent Colors - Tribe (Warm) */
            --tribe-primary: #ff6b35;
            --tribe-secondary: #f7931e;
            --tribe-glow: rgba(255, 107, 53, 0.3);
            
            /* Accent Colors - Teacher (Cool) */
            --teacher-primary: #00d4aa;
            --teacher-secondary: #00b4d8;
            --teacher-glow: rgba(0, 212, 170, 0.3);
            
            /* Accent Colors - Recon (Electric) */
            --recon-primary: #8b5cf6;
            --recon-secondary: #6366f1;
            --recon-glow: rgba(139, 92, 246, 0.3);
            
            /* Text */
            --text-primary: #e4e4e7;
            --text-secondary: #a1a1aa;
            --text-muted: #71717a;
            
            /* Status */
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --info: #3b82f6;
            
            /* Effects */
            --glass: rgba(255, 255, 255, 0.03);
            --border: rgba(255, 255, 255, 0.08);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Space Grotesk', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* Animated Background */
        .bg-grid {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(255,255,255,0.02) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255,255,255,0.02) 1px, transparent 1px);
            background-size: 50px 50px;
            pointer-events: none;
            z-index: 0;
        }
        
        .bg-gradient {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(ellipse at 20% 20%, var(--tribe-glow) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, var(--teacher-glow) 0%, transparent 50%),
                radial-gradient(ellipse at 50% 50%, var(--recon-glow) 0%, transparent 60%);
            pointer-events: none;
            z-index: 0;
            animation: gradient-shift 20s ease-in-out infinite;
        }
        
        @keyframes gradient-shift {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 0.8; }
        }
        
        /* Header */
        header {
            position: relative;
            z-index: 10;
            padding: 1.5rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border);
            backdrop-filter: blur(20px);
            background: rgba(10, 10, 15, 0.8);
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .logo-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            background: linear-gradient(135deg, var(--tribe-primary), var(--teacher-primary), var(--recon-primary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.2rem;
        }
        
        .logo-text h1 {
            font-size: 1.5rem;
            font-weight: 700;
            letter-spacing: -0.02em;
            background: linear-gradient(135deg, var(--text-primary), var(--text-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .logo-text span {
            font-size: 0.75rem;
            color: var(--text-muted);
            letter-spacing: 0.1em;
            text-transform: uppercase;
        }
        
        .header-actions {
            display: flex;
            gap: 1rem;
        }
        
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: var(--glass);
            color: var(--text-primary);
            font-family: inherit;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .btn:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.15);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--teacher-primary), var(--teacher-secondary));
            border: none;
            color: var(--bg-primary);
        }
        
        .btn-primary:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }
        
        /* Main Layout */
        main {
            position: relative;
            z-index: 10;
            padding: 2rem;
            max-width: 1800px;
            margin: 0 auto;
        }
        
        /* System Navigation Tabs */
        .system-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
            padding: 0.5rem;
            background: var(--bg-card);
            border-radius: 12px;
            border: 1px solid var(--border);
            backdrop-filter: blur(10px);
            width: fit-content;
        }
        
        .system-tab {
            padding: 0.875rem 1.5rem;
            border-radius: 8px;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            font-family: inherit;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .system-tab:hover {
            color: var(--text-primary);
            background: var(--glass);
        }
        
        .system-tab.active {
            color: var(--bg-primary);
            font-weight: 600;
        }
        
        .system-tab.active.tribe {
            background: var(--tribe-primary);
        }
        
        .system-tab.active.teacher {
            background: var(--teacher-primary);
        }
        
        .system-tab.active.recon {
            background: var(--recon-primary);
        }
        
        .system-tab.active.integration {
            background: linear-gradient(135deg, var(--tribe-primary), var(--recon-primary));
        }
        
        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 1.5rem;
        }
        
        /* Cards */
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 1.5rem;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }
        
        .card:hover {
            border-color: rgba(255, 255, 255, 0.12);
            transform: translateY(-2px);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.25rem;
        }
        
        .card-title {
            font-size: 1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .card-badge {
            font-size: 0.7rem;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .badge-tribe {
            background: var(--tribe-glow);
            color: var(--tribe-primary);
        }
        
        .badge-teacher {
            background: var(--teacher-glow);
            color: var(--teacher-primary);
        }
        
        .badge-recon {
            background: var(--recon-glow);
            color: var(--recon-primary);
        }
        
        /* Stats */
        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
            line-height: 1;
            margin-bottom: 0.25rem;
        }
        
        .stat-label {
            font-size: 0.8rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .stat-change {
            font-size: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
            margin-top: 0.5rem;
        }
        
        .stat-change.positive { color: var(--success); }
        .stat-change.negative { color: var(--error); }
        
        /* Network Visualization */
        .network-viz {
            grid-column: span 8;
            min-height: 500px;
        }
        
        #network-graph {
            width: 100%;
            height: 450px;
            border-radius: 12px;
            background: var(--bg-secondary);
        }
        
        #network-graph svg {
            width: 100%;
            height: 100%;
        }
        
        .network-node {
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .network-node:hover {
            filter: brightness(1.2);
        }
        
        .network-link {
            stroke: rgba(255, 255, 255, 0.1);
            stroke-width: 1;
        }
        
        /* Sidebar Stats */
        .stats-sidebar {
            grid-column: span 4;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .stat-card {
            padding: 1.25rem;
        }
        
        /* Lists */
        .list-container {
            grid-column: span 4;
        }
        
        .list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.875rem 0;
            border-bottom: 1px solid var(--border);
        }
        
        .list-item:last-child {
            border-bottom: none;
        }
        
        .list-item-info {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }
        
        .list-item-title {
            font-weight: 500;
        }
        
        .list-item-subtitle {
            font-size: 0.8rem;
            color: var(--text-muted);
        }
        
        .list-item-value {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 500;
        }
        
        /* Progress Bars */
        .progress-bar {
            height: 6px;
            background: var(--bg-secondary);
            border-radius: 3px;
            overflow: hidden;
            margin-top: 0.5rem;
        }
        
        .progress-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.5s ease;
        }
        
        .progress-fill.tribe { background: var(--tribe-primary); }
        .progress-fill.teacher { background: var(--teacher-primary); }
        .progress-fill.recon { background: var(--recon-primary); }
        
        /* Ethics Grades */
        .grade-badge {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 700;
            font-size: 1.25rem;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
        }
        
        .grade-A { background: var(--success); color: white; }
        .grade-B { background: #22c55e; color: white; }
        .grade-C { background: var(--warning); color: var(--bg-primary); }
        .grade-D { background: #f97316; color: white; }
        .grade-F { background: var(--error); color: white; }
        
        /* Flow Chart */
        .flow-container {
            grid-column: span 12;
            padding: 2rem;
        }
        
        .flow-diagram {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 2rem;
        }
        
        .flow-node {
            text-align: center;
            padding: 1.5rem 2rem;
            border-radius: 12px;
            border: 2px solid;
            min-width: 150px;
        }
        
        .flow-node.tribe {
            border-color: var(--tribe-primary);
            background: var(--tribe-glow);
        }
        
        .flow-node.teacher {
            border-color: var(--teacher-primary);
            background: var(--teacher-glow);
        }
        
        .flow-node.recon {
            border-color: var(--recon-primary);
            background: var(--recon-glow);
        }
        
        .flow-arrow {
            color: var(--text-muted);
            font-size: 1.5rem;
        }
        
        /* Data Upload */
        .upload-zone {
            grid-column: span 12;
            border: 2px dashed var(--border);
            border-radius: 16px;
            padding: 3rem;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .upload-zone:hover {
            border-color: var(--teacher-primary);
            background: var(--teacher-glow);
        }
        
        .upload-zone.dragover {
            border-color: var(--teacher-primary);
            background: var(--teacher-glow);
        }
        
        .upload-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
        
        .upload-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .upload-subtitle {
            color: var(--text-muted);
        }
        
        /* Tooltip */
        .tooltip {
            position: absolute;
            padding: 0.75rem 1rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 0.8rem;
            pointer-events: none;
            z-index: 100;
            max-width: 250px;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }
        
        /* Loading Spinner */
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--bg-tertiary);
            border-top-color: var(--teacher-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Hidden */
        .hidden {
            display: none !important;
        }
        
        /* Section Headers */
        .section-header {
            margin-bottom: 1.5rem;
        }
        
        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }
        
        .section-subtitle {
            color: var(--text-muted);
        }
        
        /* Responsive */
        @media (max-width: 1200px) {
            .network-viz { grid-column: span 12; }
            .stats-sidebar { grid-column: span 12; flex-direction: row; flex-wrap: wrap; }
            .stat-card { flex: 1; min-width: 200px; }
            .list-container { grid-column: span 6; }
        }
        
        @media (max-width: 768px) {
            .list-container { grid-column: span 12; }
            .flow-diagram { flex-direction: column; }
            .flow-arrow { transform: rotate(90deg); }
        }
    </style>
</head>
<body>
    <div class="bg-grid"></div>
    <div class="bg-gradient"></div>
    
    <header>
        <div class="logo">
            <div class="logo-icon">‚ö°</div>
            <div class="logo-text">
                <h1>COSURVIVAL</h1>
                <span>Connected Intelligence Network</span>
            </div>
        </div>
        <div class="header-actions">
            <button class="btn" onclick="loadDemoData()">
                <span>üìä</span> Load Demo
            </button>
            <button class="btn btn-primary" onclick="document.getElementById('fileInput').click()">
                <span>üìÅ</span> Upload Data
            </button>
            <input type="file" id="fileInput" accept=".json,.csv" class="hidden" onchange="handleFileUpload(event)">
        </div>
    </header>
    
    <main>
        <!-- System Tabs -->
        <div class="system-tabs">
            <button class="system-tab active tribe" onclick="switchTab('tribe')">
                <span>üåê</span> TRIBE
            </button>
            <button class="system-tab teacher" onclick="switchTab('teacher')">
                <span>üìö</span> TEACHER
            </button>
            <button class="system-tab recon" onclick="switchTab('recon')">
                <span>üí±</span> RECON
            </button>
            <button class="system-tab integration" onclick="switchTab('integration')">
                <span>üîó</span> INTEGRATION
            </button>
        </div>
        
        <!-- TRIBE View -->
        <div id="tribe-view" class="dashboard-grid">
            <div class="section-header" style="grid-column: span 12;">
                <h2 class="section-title">TRIBE Network</h2>
                <p class="section-subtitle">Social connections, organizational structure, and collaboration patterns</p>
            </div>
            
            <!-- Network Graph -->
            <div class="card network-viz">
                <div class="card-header">
                    <span class="card-title">
                        <span>üï∏Ô∏è</span> Network Graph
                    </span>
                    <span class="card-badge badge-tribe">LIVE</span>
                </div>
                <div id="network-graph"></div>
            </div>
            
            <!-- Stats Sidebar -->
            <div class="stats-sidebar">
                <div class="card stat-card">
                    <div class="stat-value" id="stat-users">0</div>
                    <div class="stat-label">Total Users</div>
                    <div class="stat-change positive">
                        <span>‚Üë</span> Active network
                    </div>
                </div>
                <div class="card stat-card">
                    <div class="stat-value" id="stat-companies">0</div>
                    <div class="stat-label">Companies</div>
                </div>
                <div class="card stat-card">
                    <div class="stat-value" id="stat-connections">0</div>
                    <div class="stat-label">Connections</div>
                </div>
                <div class="card stat-card">
                    <div class="stat-value" id="stat-communities">0</div>
                    <div class="stat-label">Communities</div>
                </div>
            </div>
            
            <!-- Top Connectors -->
            <div class="card list-container">
                <div class="card-header">
                    <span class="card-title">üåü Top Connectors</span>
                </div>
                <div id="top-connectors">
                    <div class="list-item">
                        <div class="list-item-info">
                            <span class="list-item-title">Load data to see connectors</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Active Companies -->
            <div class="card list-container">
                <div class="card-header">
                    <span class="card-title">üè¢ Active Companies</span>
                </div>
                <div id="active-companies">
                    <div class="list-item">
                        <div class="list-item-info">
                            <span class="list-item-title">Load data to see companies</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Group Activity -->
            <div class="card list-container">
                <div class="card-header">
                    <span class="card-title">üë• Group Activity</span>
                </div>
                <div id="group-activity">
                    <div class="list-item">
                        <div class="list-item-info">
                            <span class="list-item-title">Load data to see groups</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- TEACHER View -->
        <div id="teacher-view" class="dashboard-grid hidden">
            <div class="section-header" style="grid-column: span 12;">
                <h2 class="section-title">TEACHER Learning Pathways</h2>
                <p class="section-subtitle">Role-based curricula, skill progressions, and personalized recommendations</p>
            </div>
            
            <!-- Learning Stats -->
            <div class="card stat-card" style="grid-column: span 3;">
                <div class="stat-value" id="stat-roles">0</div>
                <div class="stat-label">Learning Tracks</div>
            </div>
            <div class="card stat-card" style="grid-column: span 3;">
                <div class="stat-value" id="stat-progressions">0</div>
                <div class="stat-label">Progressions</div>
            </div>
            <div class="card stat-card" style="grid-column: span 3;">
                <div class="stat-value" id="stat-recommendations">0</div>
                <div class="stat-label">Recommendations</div>
            </div>
            <div class="card stat-card" style="grid-column: span 3;">
                <div class="stat-value" id="stat-modules">0</div>
                <div class="stat-label">Tech Modules</div>
            </div>
            
            <!-- Roles List -->
            <div class="card list-container" style="grid-column: span 6;">
                <div class="card-header">
                    <span class="card-title">üéØ Role-Based Learning Tracks</span>
                </div>
                <div id="roles-list">
                    <div class="list-item">
                        <div class="list-item-info">
                            <span class="list-item-title">Load data to see roles</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Progressions -->
            <div class="card list-container" style="grid-column: span 6;">
                <div class="card-header">
                    <span class="card-title">üìà Common Skill Progressions</span>
                </div>
                <div id="progressions-list">
                    <div class="list-item">
                        <div class="list-item-info">
                            <span class="list-item-title">Load data to see progressions</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Recommendations -->
            <div class="card" style="grid-column: span 12;">
                <div class="card-header">
                    <span class="card-title">üí° Personalized Recommendations</span>
                    <span class="card-badge badge-teacher">AI-POWERED</span>
                </div>
                <div id="recommendations-list" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem;">
                    <div class="list-item">
                        <div class="list-item-info">
                            <span class="list-item-title">Load data to see recommendations</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- RECON View -->
        <div id="recon-view" class="dashboard-grid hidden">
            <div class="section-header" style="grid-column: span 12;">
                <h2 class="section-title">RECONSUMERALIZATION Exchange</h2>
                <p class="section-subtitle">Provider profiles, value flows, and ethics ratings</p>
            </div>
            
            <!-- Recon Stats -->
            <div class="card stat-card" style="grid-column: span 3;">
                <div class="stat-value" id="stat-providers">0</div>
                <div class="stat-label">Providers</div>
            </div>
            <div class="card stat-card" style="grid-column: span 3;">
                <div class="stat-value" id="stat-consumers">0</div>
                <div class="stat-label">Consumers</div>
            </div>
            <div class="card stat-card" style="grid-column: span 3;">
                <div class="stat-value" id="stat-flows">0</div>
                <div class="stat-label">Value Flows</div>
            </div>
            <div class="card stat-card" style="grid-column: span 3;">
                <div class="stat-value" id="stat-volume">0</div>
                <div class="stat-label">Total Volume</div>
            </div>
            
            <!-- Provider Rankings -->
            <div class="card" style="grid-column: span 8;">
                <div class="card-header">
                    <span class="card-title">üèÜ Provider Rankings</span>
                    <span class="card-badge badge-recon">ETHICS RATED</span>
                </div>
                <div id="provider-rankings">
                    <div class="list-item">
                        <div class="list-item-info">
                            <span class="list-item-title">Load data to see providers</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Ethics Distribution -->
            <div class="card" style="grid-column: span 4;">
                <div class="card-header">
                    <span class="card-title">üìä Ethics Distribution</span>
                </div>
                <div id="ethics-distribution">
                    <div style="display: flex; flex-direction: column; gap: 0.75rem; margin-top: 1rem;">
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <span class="grade-badge grade-A">A</span>
                            <div style="flex: 1;">
                                <div class="progress-bar">
                                    <div class="progress-fill recon" style="width: 0%;" id="grade-a-bar"></div>
                                </div>
                            </div>
                            <span id="grade-a-count">0</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <span class="grade-badge grade-B">B</span>
                            <div style="flex: 1;">
                                <div class="progress-bar">
                                    <div class="progress-fill recon" style="width: 0%;" id="grade-b-bar"></div>
                                </div>
                            </div>
                            <span id="grade-b-count">0</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <span class="grade-badge grade-C">C</span>
                            <div style="flex: 1;">
                                <div class="progress-bar">
                                    <div class="progress-fill recon" style="width: 0%;" id="grade-c-bar"></div>
                                </div>
                            </div>
                            <span id="grade-c-count">0</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <span class="grade-badge grade-D">D</span>
                            <div style="flex: 1;">
                                <div class="progress-bar">
                                    <div class="progress-fill recon" style="width: 0%;" id="grade-d-bar"></div>
                                </div>
                            </div>
                            <span id="grade-d-count">0</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <span class="grade-badge grade-F">F</span>
                            <div style="flex: 1;">
                                <div class="progress-bar">
                                    <div class="progress-fill recon" style="width: 0%;" id="grade-f-bar"></div>
                                </div>
                            </div>
                            <span id="grade-f-count">0</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Value Flows -->
            <div class="card" style="grid-column: span 12;">
                <div class="card-header">
                    <span class="card-title">üîÑ Top Value Flows</span>
                </div>
                <div id="value-flows" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem;">
                    <div class="list-item">
                        <div class="list-item-info">
                            <span class="list-item-title">Load data to see value flows</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Integration View -->
        <div id="integration-view" class="dashboard-grid hidden">
            <div class="section-header" style="grid-column: span 12;">
                <h2 class="section-title">Integrated Intelligence</h2>
                <p class="section-subtitle">Cross-system insights and feedback loops</p>
            </div>
            
            <!-- Flow Diagram -->
            <div class="card flow-container">
                <div class="card-header">
                    <span class="card-title">üîÑ The Cosurvival Feedback Loop</span>
                </div>
                <div class="flow-diagram">
                    <div class="flow-node tribe">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">üåê</div>
                        <div style="font-weight: 600;">TRIBE</div>
                        <div style="font-size: 0.8rem; color: var(--text-muted);">Social Network</div>
                    </div>
                    <div class="flow-arrow">‚Üí</div>
                    <div class="flow-node teacher">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">üìö</div>
                        <div style="font-weight: 600;">TEACHER</div>
                        <div style="font-size: 0.8rem; color: var(--text-muted);">Learning Paths</div>
                    </div>
                    <div class="flow-arrow">‚Üí</div>
                    <div class="flow-node recon">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">üí±</div>
                        <div style="font-weight: 600;">RECON</div>
                        <div style="font-size: 0.8rem; color: var(--text-muted);">Value Exchange</div>
                    </div>
                    <div class="flow-arrow">‚Üí</div>
                    <div class="flow-node tribe">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">‚ôªÔ∏è</div>
                        <div style="font-weight: 600;">CYCLE</div>
                        <div style="font-size: 0.8rem; color: var(--text-muted);">Continuous</div>
                    </div>
                </div>
            </div>
            
            <!-- Insights -->
            <div class="card" style="grid-column: span 12;">
                <div class="card-header">
                    <span class="card-title">üí° Cross-System Insights</span>
                    <span class="card-badge badge-teacher">TRIPLE BALANCE</span>
                </div>
                <div id="insights-list" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem;">
                    <div class="card" style="border-color: var(--tribe-primary);">
                        <h4 style="color: var(--tribe-primary); margin-bottom: 0.5rem;">üß† AI Logic</h4>
                        <p style="font-size: 0.85rem; color: var(--text-secondary);">
                            Data-driven analysis of network patterns, learning gaps, and value flows
                        </p>
                    </div>
                    <div class="card" style="border-color: var(--teacher-primary);">
                        <h4 style="color: var(--teacher-primary); margin-bottom: 0.5rem;">üîü 10th Man</h4>
                        <p style="font-size: 0.85rem; color: var(--text-secondary);">
                            Challenging assumptions and identifying blind spots in the analysis
                        </p>
                    </div>
                    <div class="card" style="border-color: var(--recon-primary);">
                        <h4 style="color: var(--recon-primary); margin-bottom: 0.5rem;">üîÆ Witch</h4>
                        <p style="font-size: 0.85rem; color: var(--text-secondary);">
                            Intuitive pattern recognition beyond what the data shows
                        </p>
                    </div>
                </div>
            </div>
            
            <!-- Upload Zone -->
            <div class="upload-zone" id="upload-zone">
                <div class="upload-icon">üìÅ</div>
                <div class="upload-title">Drop your data file here</div>
                <div class="upload-subtitle">Supports JSON (processed) or CSV (raw activity data)</div>
            </div>
        </div>
    </main>
    
    <!-- Tooltip -->
    <div class="tooltip hidden" id="tooltip"></div>
    
    <script>
        // State
        let currentTab = 'tribe';
        let data = null;
        
        // Tab switching
        function switchTab(tab) {
            currentTab = tab;
            
            // Update tab buttons
            document.querySelectorAll('.system-tab').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`.system-tab.${tab}`).classList.add('active');
            
            // Update views
            document.querySelectorAll('[id$="-view"]').forEach(view => {
                view.classList.add('hidden');
            });
            document.getElementById(`${tab}-view`).classList.remove('hidden');
        }
        
        // File upload handling
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    if (file.name.endsWith('.json')) {
                        data = JSON.parse(e.target.result);
                        updateDashboard(data);
                    } else if (file.name.endsWith('.csv')) {
                        alert('CSV detected! Please run csv_data_processor.py first to generate JSON.');
                    }
                } catch (error) {
                    console.error('Error parsing file:', error);
                    alert('Error parsing file. Please check the format.');
                }
            };
            reader.readAsText(file);
        }
        
        // Drag and drop
        const uploadZone = document.getElementById('upload-zone');
        
        uploadZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadZone.classList.add('dragover');
        });
        
        uploadZone.addEventListener('dragleave', () => {
            uploadZone.classList.remove('dragover');
        });
        
        uploadZone.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadZone.classList.remove('dragover');
            
            const file = e.dataTransfer.files[0];
            if (file) {
                const input = document.getElementById('fileInput');
                input.files = e.dataTransfer.files;
                handleFileUpload({ target: input });
            }
        });
        
        // Update dashboard with data
        function updateDashboard(data) {
            if (!data) return;
            
            // Update TRIBE stats
            if (data.tribe) {
                const users = data.tribe.users || {};
                const companies = data.tribe.companies || {};
                const relationships = data.tribe.relationships || [];
                const communities = data.tribe.communities || [];
                
                document.getElementById('stat-users').textContent = Object.keys(users).length.toLocaleString();
                document.getElementById('stat-companies').textContent = Object.keys(companies).length.toLocaleString();
                document.getElementById('stat-connections').textContent = relationships.length.toLocaleString();
                document.getElementById('stat-communities').textContent = communities.length.toLocaleString();
                
                // Top connectors
                const usersList = Object.values(users).sort((a, b) => (b.activity_count || 0) - (a.activity_count || 0)).slice(0, 5);
                updateList('top-connectors', usersList.map(u => ({
                    title: u.name || u.id,
                    subtitle: `${u.activity_count || 0} activities`,
                    value: u.connections?.length || 0
                })));
                
                // Active companies
                const companiesList = Object.values(companies).sort((a, b) => (b.activity_count || 0) - (a.activity_count || 0)).slice(0, 5);
                updateList('active-companies', companiesList.map(c => ({
                    title: c.name || c.id,
                    subtitle: `${c.users?.length || 0} users`,
                    value: c.activity_count || 0
                })));
                
                // Render network graph
                renderNetworkGraph(data.tribe);
            }
            
            // Update TEACHER stats
            if (data.teacher) {
                const roles = data.teacher.roles || {};
                const progressions = data.teacher.progressions || [];
                const recommendations = data.teacher.recommendations || [];
                const curriculum = data.teacher.technology_curriculum || {};
                
                document.getElementById('stat-roles').textContent = Object.keys(roles).length;
                document.getElementById('stat-progressions').textContent = progressions.length;
                document.getElementById('stat-recommendations').textContent = recommendations.length;
                document.getElementById('stat-modules').textContent = Object.values(curriculum).reduce((a, b) => a + b.length, 0);
                
                // Roles list
                const rolesList = Object.values(roles).slice(0, 5);
                updateList('roles-list', rolesList.map(r => ({
                    title: r.name || r.id,
                    subtitle: `${r.required_skills?.length || 0} skills required`,
                    value: `${r.user_count || 0} users`
                })));
                
                // Progressions list
                updateList('progressions-list', progressions.slice(0, 5).map(p => ({
                    title: p.transition || `${p.from} ‚Üí ${p.to}`,
                    subtitle: p.significance || 'Common transition',
                    value: p.count || p.frequency || 0
                })));
                
                // Recommendations
                updateRecommendations('recommendations-list', recommendations.slice(0, 6));
            }
            
            // Update RECON stats
            if (data.reconsumeralization) {
                const providers = data.reconsumeralization.providers || {};
                const consumers = data.reconsumeralization.consumers || {};
                const flows = data.reconsumeralization.value_flows || [];
                const stats = data.reconsumeralization.stats || {};
                
                document.getElementById('stat-providers').textContent = Object.keys(providers).length;
                document.getElementById('stat-consumers').textContent = Object.keys(consumers).length;
                document.getElementById('stat-flows').textContent = flows.length;
                document.getElementById('stat-volume').textContent = (stats.total_value_exchanged || 0).toLocaleString();
                
                // Provider rankings
                const providersList = Object.values(providers).sort((a, b) => (b.reliability_score || 0) - (a.reliability_score || 0)).slice(0, 8);
                updateProviderRankings('provider-rankings', providersList);
                
                // Ethics distribution
                const grades = stats.ethics_grades || {};
                updateEthicsDistribution(grades);
                
                // Value flows
                const topFlows = flows.sort((a, b) => (b.volume || 0) - (a.volume || 0)).slice(0, 8);
                updateValueFlows('value-flows', topFlows, providers, consumers);
            }
        }
        
        // Update list helper
        function updateList(containerId, items) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            container.innerHTML = items.map(item => `
                <div class="list-item">
                    <div class="list-item-info">
                        <span class="list-item-title">${item.title}</span>
                        <span class="list-item-subtitle">${item.subtitle}</span>
                    </div>
                    <span class="list-item-value">${item.value}</span>
                </div>
            `).join('') || '<div class="list-item"><span class="list-item-title">No data</span></div>';
        }
        
        // Update recommendations
        function updateRecommendations(containerId, recommendations) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            container.innerHTML = recommendations.map(rec => `
                <div class="card" style="padding: 1rem; border-color: ${rec.priority === 'high' ? 'var(--warning)' : 'var(--border)'};">
                    <div style="font-weight: 500; margin-bottom: 0.5rem;">User: ${rec.user_id?.substring(0, 8) || 'Unknown'}...</div>
                    <div style="font-size: 0.8rem; color: var(--text-muted); margin-bottom: 0.5rem;">${rec.reason || 'Skill gap analysis'}</div>
                    <div style="font-size: 0.75rem;">
                        ${(rec.recommended_skills || []).slice(0, 3).map(s => `<span style="background: var(--teacher-glow); color: var(--teacher-primary); padding: 0.2rem 0.5rem; border-radius: 4px; margin-right: 0.25rem;">${s}</span>`).join('')}
                    </div>
                </div>
            `).join('') || '<div>No recommendations</div>';
        }
        
        // Update provider rankings
        function updateProviderRankings(containerId, providers) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            container.innerHTML = providers.map((p, i) => `
                <div class="list-item">
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <span style="font-size: 1.25rem; font-weight: 700; color: var(--text-muted);">#${i + 1}</span>
                        <div class="list-item-info">
                            <span class="list-item-title">${p.name || p.id}</span>
                            <span class="list-item-subtitle">${p.customer_count || 0} customers ‚Ä¢ ${p.user_count || 0} users</span>
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <div style="text-align: right;">
                            <div style="font-size: 0.75rem; color: var(--text-muted);">Reliability</div>
                            <div style="font-weight: 600;">${((p.reliability_score || 0) * 100).toFixed(1)}%</div>
                        </div>
                        <span class="grade-badge grade-${p.ethics_grade || 'C'}">${p.ethics_grade || 'C'}</span>
                    </div>
                </div>
            `).join('') || '<div>No providers</div>';
        }
        
        // Update ethics distribution
        function updateEthicsDistribution(grades) {
            const total = Object.values(grades).reduce((a, b) => a + b, 0) || 1;
            
            ['A', 'B', 'C', 'D', 'F'].forEach(grade => {
                const count = grades[grade] || 0;
                const percent = (count / total) * 100;
                document.getElementById(`grade-${grade.toLowerCase()}-bar`).style.width = `${percent}%`;
                document.getElementById(`grade-${grade.toLowerCase()}-count`).textContent = count;
            });
        }
        
        // Update value flows
        function updateValueFlows(containerId, flows, providers, consumers) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            container.innerHTML = flows.map(f => {
                const provider = providers[f.from_provider] || providers[f.from] || { name: f.from_provider || f.from };
                const consumer = consumers[f.to_company] || consumers[f.to] || { name: f.to_company || f.to };
                
                return `
                    <div class="card" style="padding: 1rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <span style="font-size: 0.75rem; color: var(--recon-primary);">FROM</span>
                            <span style="font-size: 0.75rem; color: var(--tribe-primary);">TO</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem;">
                            <span style="font-weight: 500;">${(provider.name || 'Unknown').substring(0, 15)}</span>
                            <span>‚Üí</span>
                            <span style="font-weight: 500;">${(consumer.name || 'Unknown').substring(0, 15)}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; font-size: 0.8rem; color: var(--text-muted);">
                            <span>Volume: ${(f.volume || 0).toLocaleString()}</span>
                            <span>Quality: ${((f.quality || 1) * 100).toFixed(0)}%</span>
                        </div>
                    </div>
                `;
            }).join('') || '<div>No value flows</div>';
        }
        
        // Render network graph with D3
        function renderNetworkGraph(tribeData) {
            const container = document.getElementById('network-graph');
            container.innerHTML = '';
            
            const width = container.clientWidth;
            const height = container.clientHeight || 450;
            
            const svg = d3.select('#network-graph')
                .append('svg')
                .attr('width', width)
                .attr('height', height);
            
            // Prepare data
            const nodes = [];
            const links = [];
            
            // Add user nodes (limit for performance)
            const users = Object.values(tribeData.users || {}).slice(0, 100);
            users.forEach(user => {
                nodes.push({
                    id: user.id,
                    name: user.name || user.id,
                    type: 'user',
                    size: Math.min(5 + (user.activity_count || 0) / 50, 20)
                });
            });
            
            // Add relationship links
            const relationships = (tribeData.relationships || []).slice(0, 200);
            relationships.forEach(rel => {
                if (nodes.find(n => n.id === rel.source) && nodes.find(n => n.id === rel.target)) {
                    links.push({
                        source: rel.source,
                        target: rel.target,
                        weight: rel.weight || 1
                    });
                }
            });
            
            if (nodes.length === 0) {
                svg.append('text')
                    .attr('x', width / 2)
                    .attr('y', height / 2)
                    .attr('text-anchor', 'middle')
                    .attr('fill', '#71717a')
                    .text('Load data to visualize network');
                return;
            }
            
            // Create force simulation
            const simulation = d3.forceSimulation(nodes)
                .force('link', d3.forceLink(links).id(d => d.id).distance(50))
                .force('charge', d3.forceManyBody().strength(-100))
                .force('center', d3.forceCenter(width / 2, height / 2))
                .force('collision', d3.forceCollide().radius(d => d.size + 5));
            
            // Draw links
            const link = svg.append('g')
                .selectAll('line')
                .data(links)
                .join('line')
                .attr('class', 'network-link')
                .attr('stroke-width', d => Math.min(d.weight, 3));
            
            // Draw nodes
            const node = svg.append('g')
                .selectAll('circle')
                .data(nodes)
                .join('circle')
                .attr('class', 'network-node')
                .attr('r', d => d.size)
                .attr('fill', d => d.type === 'company' ? '#ff6b35' : '#00d4aa')
                .call(drag(simulation));
            
            // Add labels for larger nodes
            const labels = svg.append('g')
                .selectAll('text')
                .data(nodes.filter(n => n.size > 10))
                .join('text')
                .attr('font-size', '10px')
                .attr('fill', '#e4e4e7')
                .attr('text-anchor', 'middle')
                .attr('dy', d => d.size + 12)
                .text(d => d.name?.substring(0, 10) || '');
            
            // Tooltip
            const tooltip = d3.select('#tooltip');
            
            node.on('mouseover', (event, d) => {
                tooltip.classed('hidden', false)
                    .html(`<strong>${d.name}</strong><br/>Type: ${d.type}<br/>Connections: ${links.filter(l => l.source.id === d.id || l.target.id === d.id).length}`)
                    .style('left', (event.pageX + 10) + 'px')
                    .style('top', (event.pageY - 10) + 'px');
            })
            .on('mouseout', () => {
                tooltip.classed('hidden', true);
            });
            
            // Update positions
            simulation.on('tick', () => {
                link
                    .attr('x1', d => d.source.x)
                    .attr('y1', d => d.source.y)
                    .attr('x2', d => d.target.x)
                    .attr('y2', d => d.target.y);
                
                node
                    .attr('cx', d => d.x = Math.max(d.size, Math.min(width - d.size, d.x)))
                    .attr('cy', d => d.y = Math.max(d.size, Math.min(height - d.size, d.y)));
                
                labels
                    .attr('x', d => d.x)
                    .attr('y', d => d.y);
            });
            
            // Drag behavior
            function drag(simulation) {
                function dragstarted(event) {
                    if (!event.active) simulation.alphaTarget(0.3).restart();
                    event.subject.fx = event.subject.x;
                    event.subject.fy = event.subject.y;
                }
                
                function dragged(event) {
                    event.subject.fx = event.x;
                    event.subject.fy = event.y;
                }
                
                function dragended(event) {
                    if (!event.active) simulation.alphaTarget(0);
                    event.subject.fx = null;
                    event.subject.fy = null;
                }
                
                return d3.drag()
                    .on('start', dragstarted)
                    .on('drag', dragged)
                    .on('end', dragended);
            }
        }
        
        // Load demo data
        function loadDemoData() {
            const demoData = {
                tribe: {
                    users: {
                        'u1': { id: 'u1', name: 'Alice Chen', email: 'alice@company.com', activity_count: 450, connections: ['u2', 'u3', 'u4'] },
                        'u2': { id: 'u2', name: 'Bob Smith', email: 'bob@company.com', activity_count: 380, connections: ['u1', 'u3'] },
                        'u3': { id: 'u3', name: 'Carol Davis', email: 'carol@company.com', activity_count: 290, connections: ['u1', 'u2', 'u5'] },
                        'u4': { id: 'u4', name: 'David Lee', email: 'david@company.com', activity_count: 210, connections: ['u1'] },
                        'u5': { id: 'u5', name: 'Eva Martinez', email: 'eva@company.com', activity_count: 175, connections: ['u3', 'u6'] },
                        'u6': { id: 'u6', name: 'Frank Wilson', email: 'frank@company.com', activity_count: 150, connections: ['u5'] }
                    },
                    companies: {
                        'c1': { id: 'c1', name: 'TechCorp Inc', users: ['u1', 'u2'], activity_count: 830 },
                        'c2': { id: 'c2', name: 'DataFlow Ltd', users: ['u3', 'u4'], activity_count: 500 },
                        'c3': { id: 'c3', name: 'CloudScale', users: ['u5', 'u6'], activity_count: 325 }
                    },
                    relationships: [
                        { source: 'u1', target: 'u2', weight: 45, type: 'collaboration' },
                        { source: 'u1', target: 'u3', weight: 30, type: 'collaboration' },
                        { source: 'u2', target: 'u3', weight: 25, type: 'collaboration' },
                        { source: 'u1', target: 'u4', weight: 20, type: 'collaboration' },
                        { source: 'u3', target: 'u5', weight: 15, type: 'collaboration' },
                        { source: 'u5', target: 'u6', weight: 10, type: 'collaboration' }
                    ],
                    communities: [
                        { id: 0, members: ['u1', 'u2', 'u3', 'u4'], size: 4 },
                        { id: 1, members: ['u5', 'u6'], size: 2 }
                    ]
                },
                teacher: {
                    roles: {
                        'r1': { id: 'r1', name: 'Data Engineer', required_skills: ['Python', 'SQL', 'ETL', 'Cloud'], user_count: 12 },
                        'r2': { id: 'r2', name: 'Product Manager', required_skills: ['Strategy', 'Agile', 'Analytics'], user_count: 8 },
                        'r3': { id: 'r3', name: 'Full Stack Developer', required_skills: ['React', 'Node.js', 'TypeScript'], user_count: 15 },
                        'r4': { id: 'r4', name: 'DevOps Engineer', required_skills: ['Docker', 'Kubernetes', 'CI/CD'], user_count: 6 }
                    },
                    progressions: [
                        { transition: 'Junior ‚Üí Mid-Level', count: 145, significance: 'high' },
                        { transition: 'Mid-Level ‚Üí Senior', count: 89, significance: 'high' },
                        { transition: 'Individual ‚Üí Team Lead', count: 34, significance: 'medium' },
                        { transition: 'Engineer ‚Üí Architect', count: 12, significance: 'low' }
                    ],
                    recommendations: [
                        { user_id: 'u1234567', recommended_skills: ['Kubernetes', 'Terraform'], reason: 'Common skills for Data Engineers', priority: 'high' },
                        { user_id: 'u2345678', recommended_skills: ['React', 'GraphQL'], reason: 'Growing demand in your team', priority: 'medium' },
                        { user_id: 'u3456789', recommended_skills: ['Leadership', 'Mentoring'], reason: 'Preparing for team lead role', priority: 'high' }
                    ],
                    technology_curriculum: {
                        'r1': [{ provider: 'AWS', priority: 1 }, { provider: 'Snowflake', priority: 2 }],
                        'r3': [{ provider: 'Vercel', priority: 1 }, { provider: 'GitHub', priority: 2 }]
                    }
                },
                reconsumeralization: {
                    providers: {
                        'p1': { id: 'p1', name: 'AWS', customer_count: 45, user_count: 890, reliability_score: 0.998, ethics_grade: 'A' },
                        'p2': { id: 'p2', name: 'Google Cloud', customer_count: 38, user_count: 720, reliability_score: 0.995, ethics_grade: 'A' },
                        'p3': { id: 'p3', name: 'Azure', customer_count: 42, user_count: 810, reliability_score: 0.992, ethics_grade: 'B' },
                        'p4': { id: 'p4', name: 'Stripe', customer_count: 30, user_count: 450, reliability_score: 0.999, ethics_grade: 'A' },
                        'p5': { id: 'p5', name: 'Twilio', customer_count: 25, user_count: 320, reliability_score: 0.985, ethics_grade: 'B' },
                        'p6': { id: 'p6', name: 'SendGrid', customer_count: 20, user_count: 280, reliability_score: 0.970, ethics_grade: 'C' }
                    },
                    consumers: {
                        'c1': { id: 'c1', name: 'TechCorp Inc', providers_used: ['p1', 'p4'], total_users: 150 },
                        'c2': { id: 'c2', name: 'DataFlow Ltd', providers_used: ['p2', 'p5'], total_users: 80 },
                        'c3': { id: 'c3', name: 'CloudScale', providers_used: ['p3', 'p6'], total_users: 45 }
                    },
                    value_flows: [
                        { from_provider: 'p1', to_company: 'c1', volume: 15000, quality: 0.99 },
                        { from_provider: 'p2', to_company: 'c2', volume: 12000, quality: 0.98 },
                        { from_provider: 'p3', to_company: 'c3', volume: 8000, quality: 0.95 },
                        { from_provider: 'p4', to_company: 'c1', volume: 5000, quality: 0.999 }
                    ],
                    stats: {
                        total_value_exchanged: 40000,
                        ethics_grades: { 'A': 3, 'B': 2, 'C': 1, 'D': 0, 'F': 0 }
                    }
                }
            };
            
            data = demoData;
            updateDashboard(demoData);
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            // Check for cosurvival_data.json
            fetch('cosurvival_data.json')
                .then(response => response.json())
                .then(jsonData => {
                    data = jsonData;
                    updateDashboard(jsonData);
                })
                .catch(() => {
                    console.log('No pre-loaded data found. Click "Load Demo" or upload your data.');
                });
        });
    </script>
</body>
</html>

