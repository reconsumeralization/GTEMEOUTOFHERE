{% extends "base.html" %}
{% block content %}
  <div class="panel">
    <h2>Tribe Lens</h2>
    <p class="muted">Collaboration network with optional company scoping.</p>
    <form method="get" aria-label="Filter tribe by company">
      <label>
        Company ID (optional)
        <input name="company_id" value="{{ company_id or '' }}" placeholder="acme-co" autocomplete="off">
      </label>
      <button type="submit">Apply Filter</button>
    </form>
  </div>

  <div class="panel">
    <h3>Stats</h3>
    {% if stats %}
      <div class="kpi-grid">
        <div class="kpi">
          <strong>{{ stats.get("user_count", 0) }}</strong>
          <span>Users in scope</span>
        </div>
        <div class="kpi">
          <strong>{{ stats.get("group_count", stats.get("company_count", 0)) }}</strong>
          <span>{{ "Groups" if stats.get("group_count") is not none else "Companies" }}</span>
        </div>
      </div>
    {% else %}
      <p class="muted">No stats available yet. Populate the database via the ingestion pipeline.</p>
    {% endif %}
  </div>

  <div class="panel">
    <h3>API + Artifacts</h3>
    <ul>
      <li><code>/api/v1/tribe/graph</code> (supports <code>?company_id=</code>)</li>
      <li><code>tribe_network.json</code> (generated by <code>pipeline.py</code>)</li>
    </ul>
  </div>
{% endblock %}
